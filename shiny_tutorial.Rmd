---
title: "Développement d'une application Shiny"
author:
  - name: "Amandine Velt"
    orcid: "0000-0002-3287-0786"
    affiliations: "SVQV"
  - name: "Joseph Tran"
    orcid: "0000-0002-4624-0363"
    affiliations: "EGFV"
date: "2024-03-19"
output:
  learnr::tutorial:
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
description: >
  Learn how to build a shiny application.
---

```{r setup, include=FALSE}
library(learnr)
```


## Introduction

Pour le tutoriel, nous allons utiliser un jeu de données intégré à R, nommé Iris. Il recense les tailles de pétales et de sépales pour un ensemble d'individus "iris" de trois espèces différentes, setosa, versicolor et virginica.

Exécuter le code suivant, bouton `Run code`, pour afficher les premières lignes du jeu de données:

```{r iris, exercise=TRUE}
head(iris)
```


## Base d'une application Shiny

La base de notre application Shiny de départ est comprise dans deux fichiers obligatoires au fonctionnement d'une application Shiny, `ui.R` et `server.R`.

### ui.R

Voici un exemple de `ui.R` que nous allons utiliser.

```{r ui_R, exercise=TRUE}
# k-means only works with numerical variables,
# so don't give the user the option to select
# a categorical variable
vars <- setdiff(names(iris), "Species")

pageWithSidebar(
  headerPanel('Iris k-means clustering'),
  sidebarPanel(
    selectInput('xcol', 'X Variable', vars),
    selectInput('ycol', 'Y Variable', vars, selected = vars[[2]]),
    numericInput('clusters', 'Cluster count', 3, min = 1, max = 9)
  ),
  mainPanel(
    tabsetPanel(type = "tabs",
                tabPanel("Plot", plotOutput('plot1')),
                tabPanel("Summary", verbatimTextOutput("summary")),
                tabPanel("Table", tableOutput("table"))
    )
  )
)
```

### server.R

Exemple de fichier server.R vide : 

```{r server_R, exercise=FALSE, eval=FALSE}
function(input, output, session) {

}
```

Il s'agit maintenant de remplir le fichier server.R pour obtenir des résultats dans les tabPanel "Plot", "Summary" et "Table".  

### Générer un tableau dynamique dans une fonction reactive({})

Créer une reactive avec reactive({}) pour générer un tableau dynamique récupérant les 2 colonnes correspondant aux variables X et Y sélectionnées par l’utilisateur sur les données iris et ranger ce tableau dans une variable « selectedData »

```{r server_R_selected_data, exercise=TRUE}
function(input, output, session) {

}
```

```{r server_R_selected_data-solution}
function(input, output, session) {
  
  # Combine the selected variables into a new data frame
  selectedData <- reactive({
    iris[, c(input$xcol, input$ycol)]
  })
}
```

### Générer le clustering k-means dasn une fonction reactive({})

Créer une reactive avec reactive({}) pour générer un cluster sur le tableau dynamique précédent, utilisant la variable « Cluster count » comme nombre de clusters à créer et ranger ce résultat dans une variable « clusters ». Utiliser la fonction kmeans() pour générer ces clusters.

```{r server_R_clusters, exercise=TRUE}
function(input, output, session) {
  
  # Combine the selected variables into a new data frame
  selectedData <- reactive({
    iris[, c(input$xcol, input$ycol)]
  })
  
}
```

```{r server_R_clusters-solution}
function(input, output, session) {
  
  # Combine the selected variables into a new data frame
  selectedData <- reactive({
    iris[, c(input$xcol, input$ycol)]
  })
  
  clusters <- reactive({
    kmeans(selectedData(), input$clusters)
  })
}
```